# M2.5: MCP Catalog Realization & Population

**Date**: 2026-02-15
**Status**: Complete
**Phase**: Phase 2: Catalog Management Experience

## Summary

This milestone delivered a complete MCP Catalog browsing experience: extended McpServer schema with 10 new properties, 7 real MCP server entries (Kubernetes, OpenShift, Ansible, Postgres, GitHub, Slack, Jira), BFF proxy handlers for MCP entity listing/detail, a React/PatternFly gallery UI with sidebar filters and search, server detail pages with overview tabs, and rich mock data for development. The UI is accessible at `/mcp-catalog` alongside the existing Model Catalog.

## Motivation

- The MCP plugin backend existed but only had toy data (filesystem-server, database-query-server, web-search-server) with minimal schema fields.
- There was no dedicated MCP Catalog browsing experience -- only the generic Catalog Management admin view.
- Operators and developers need a gallery-style UI to discover MCP servers by deployment mode, category, provider, transport, and license.
- The schema needed enrichment to support real-world MCP server metadata (container images, endpoints, transport protocols, verification status).
- Aligns with PR #2029 (chambridge's MCP Catalog API + gallery UI) and PR #2213 (Al-Pragliola's MCP catalog OpenAPI spec).

## What Changed

### Files Created

**Backend (Go)**

| File | Purpose |
|------|---------|
| `catalog/plugins/mcp/management.go` | MCP plugin management interfaces: SourceManager, RefreshProvider, DiagnosticsProvider, UIHintsProvider, CLIHintsProvider |
| `catalog/plugins/model/management.go` | Model plugin management interfaces (same 5 interfaces) |
| `pkg/catalog/plugin/management_types.go` | Management type definitions: SourceInfo, ValidationResult, RefreshResult, PluginDiagnostics, UIHints, CLIHints |
| `pkg/catalog/plugin/management_handlers.go` | HTTP handlers for source CRUD, refresh, diagnostics via chi router |
| `pkg/catalog/plugin/rbac.go` | RBAC middleware: Role enum, RoleExtractor, RequireRole() |
| `pkg/catalog/plugin/rbac_test.go` | 11 RBAC test cases |
| `pkg/catalog/plugin/management_handlers_test.go` | 10 management handler test cases |
| `cmd/catalog/main.go` | CLI root command |
| `cmd/catalog/plugins.go` | `catalog plugins list/get` commands |
| `cmd/catalog/sources.go` | `catalog sources list/validate/apply/enable/disable/delete` commands |
| `cmd/catalog/refresh.go` | `catalog refresh trigger` command |
| `cmd/catalog/status.go` | `catalog status` command |
| `cmd/catalog/output.go` | Table/JSON/YAML output formatting |

**BFF Backend (Go)**

| File | Purpose |
|------|---------|
| `clients/ui/bff/internal/models/mcp_catalog.go` | McpServer and McpServerList BFF types with all extended fields |
| `clients/ui/bff/internal/models/catalog_management.go` | Management BFF model types |
| `clients/ui/bff/internal/api/mcp_catalog_handler.go` | GetMcpServersHandler and GetMcpServerHandler -- proxy to catalog server |
| `clients/ui/bff/internal/api/catalog_management_handler.go` | 8 catalog management HTTP handlers |
| `clients/ui/bff/internal/repositories/catalog_management.go` | CatalogManagementInterface with 9 methods + MCP browsing methods |
| `clients/ui/bff/internal/repositories/mcp_catalog.go` | MCP catalog repository implementation |
| `clients/ui/bff/internal/integrations/kubernetes/k8mocks/fake_clientset.go` | fake.NewSimpleClientset for Windows dev |

**Frontend (TypeScript/React)**

| File | Purpose |
|------|---------|
| `clients/ui/frontend/src/app/mcpCatalogTypes.ts` | McpServer type, McpServerList, McpCatalogFilterKey enum, filter states |
| `clients/ui/frontend/src/app/api/mcpCatalog/service.ts` | getMcpServers and getMcpServer curried API functions |
| `clients/ui/frontend/src/app/context/mcpCatalog/McpCatalogContext.tsx` | React context provider with client-side filtering and search |
| `clients/ui/frontend/src/app/routes/mcpCatalog/mcpCatalog.ts` | Route constants: mcpCatalogUrl(), mcpServerDetailUrl() |
| `clients/ui/frontend/src/app/pages/mcpCatalog/McpCatalogRoutes.tsx` | Route definitions wrapped in McpCatalogContextProvider |
| `clients/ui/frontend/src/app/pages/mcpCatalog/screens/McpCatalogPage.tsx` | Gallery page with Sidebar, filters, search, card grid |
| `clients/ui/frontend/src/app/pages/mcpCatalog/components/McpServerCard.tsx` | PatternFly Card with badges, tool/resource/prompt counts, labels |
| `clients/ui/frontend/src/app/pages/mcpCatalog/components/McpCatalogFilters.tsx` | Sidebar filters: Deployment Mode, Category, License, Transport |
| `clients/ui/frontend/src/app/pages/mcpCatalog/screens/McpServerDetailPage.tsx` | Detail page with breadcrumb, header, badges, Overview tab |
| `clients/ui/frontend/src/app/catalogManagementTypes.ts` | Catalog management TypeScript types |
| `clients/ui/frontend/src/app/api/catalogManagement/service.ts` | Catalog management API service functions |
| `clients/ui/frontend/src/app/context/catalogManagement/CatalogManagementContext.tsx` | Catalog management React context |
| `clients/ui/frontend/src/app/routes/catalogManagement/catalogManagement.ts` | Catalog management route helpers |
| `clients/ui/frontend/src/app/pages/catalogManagement/CatalogManagementRoutes.tsx` | Catalog management route definitions |
| `clients/ui/frontend/src/app/pages/catalogManagement/screens/CatalogManagementPage.tsx` | Plugin gallery page |
| `clients/ui/frontend/src/app/pages/catalogManagement/screens/PluginDetailPage.tsx` | Plugin detail with tabs |
| `clients/ui/frontend/src/app/pages/catalogManagement/screens/PluginSourcesPage.tsx` | Source management table |
| `clients/ui/frontend/src/app/pages/catalogManagement/screens/PluginDiagnosticsPage.tsx` | Diagnostics view |

### Files Modified

| File | Change |
|------|--------|
| `catalog/plugins/mcp/catalog.yaml` | Added 10 new properties: deploymentMode, image, endpoint, supportedTransports, license, verified, certified, provider, logo, category |
| `catalog/plugins/mcp/internal/db/models/mcpserver.go` | Regenerated with new McpServerAttributes fields |
| `catalog/plugins/mcp/api/openapi/src/generated/components.yaml` | Regenerated with new OpenAPI schema properties |
| `catalog/plugins/mcp/internal/db/service/filter_mappings.go` | Regenerated filter mappings for new fields |
| `catalog/plugins/mcp/internal/db/service/spec.go` | Regenerated spec with new field accessors |
| `catalog/plugins/mcp/plugin.go` | Regenerated plugin registration |
| `catalog/plugins/mcp/internal/catalog/providers/yaml_provider.go` | Extended yamlMcpServer struct and property mapping for all new fields |
| `catalog/plugins/mcp/internal/catalog/providers/yaml_provider_test.go` | Updated tests for new fields |
| `catalog/plugins/mcp/testdata/mcp-servers.yaml` | Replaced toy data with 7 real MCP server entries |
| `clients/ui/bff/internal/api/app.go` | Added MCP catalog route constants and route registration with AttachNamespace + AttachModelCatalogRESTClient; added catalog management routes; fake clientset fallback |
| `clients/ui/bff/internal/repositories/model_catalog_client.go` | Embedded CatalogManagementInterface; added GetMcpServers/GetMcpServer to interface |
| `clients/ui/bff/internal/mocks/model_catalog_client_mock.go` | Added mock implementations with 7 realistic MCP server entries |
| `clients/ui/bff/internal/mocks/http_mock.go` | Added DELETE mock |
| `clients/ui/bff/internal/integrations/httpclient/http.go` | Added DELETE method to HTTPClientInterface |
| `clients/ui/bff/internal/integrations/kubernetes/k8mocks/base_testenv.go` | Changed os.Exit(1) to error returns |
| `clients/ui/bff/internal/integrations/kubernetes/k8mocks/mock_factory.go` | Added testEnv nil guard |
| `clients/ui/frontend/src/app/AppRoutes.tsx` | Added MCP Catalog route and nav item; added Catalog Management under Settings |
| `pkg/catalog/plugin/plugin.go` | Added 5 optional management interfaces |
| `pkg/catalog/plugin/server.go` | Added ServerOption functional options, WithRoleExtractor; MountRoutes mounts managementRouter; pluginsHandler includes management capabilities |
| `pkg/catalog/loader.go` | Added Config() accessor |
| `catalog/internal/catalog/loader.go` | Added public Reload() method |
| `cmd/catalog-gen/helpers.go` | Code generation improvements |

## How It Works

### Extended MCP Server Schema

The `catalog.yaml` was extended with 10 new properties that map through the full stack:

```yaml
# catalog/plugins/mcp/catalog.yaml (excerpt)
properties:
  - name: deploymentMode    # "local" or "remote"
    type: string
  - name: image             # Container image ref (e.g. quay.io/kubeflow/kubernetes-mcp-server:latest)
    type: string
  - name: verified          # Has the server been verified
    type: boolean
  - name: certified         # Is it certified by Red Hat
    type: boolean
  - name: provider          # Organization providing the server
    type: string
  - name: category          # Category label (Red Hat, DevOps, Database, Communication)
    type: string
```

These flow through catalog-gen to Go models, OpenAPI schema, and filter mappings.

### Real MCP Server Data

Seven production-quality entries replace the toy test data in `testdata/mcp-servers.yaml`:

| Server | Mode | Provider | Category | Transports | Tools |
|--------|------|----------|----------|------------|-------|
| kubernetes-mcp-server | local | Red Hat | Red Hat | stdio, http | 12 |
| openshift-mcp-server | local | Red Hat | Red Hat | stdio, http | 18 |
| ansible-mcp-server | local | Red Hat | Red Hat | stdio | 10 |
| postgres-mcp-server | local | Crunchy Data | Database | stdio | 8 |
| github-mcp-server | remote | GitHub | DevOps | http, sse | 15 |
| slack-mcp-server | remote | Slack | Communication | http | 9 |
| jira-mcp-server | remote | Atlassian | DevOps | http | 11 |

### BFF Proxy for MCP Browsing

Two new handlers proxy MCP entity list/get requests:

```
Frontend (localhost:9000)  -->  BFF (localhost:4000)  -->  Catalog Server (localhost:8081)
   React gallery               /api/v1/mcp_catalog/      /api/mcp_catalog/v1alpha1/
                                mcpservers                 mcpservers
```

| Method | BFF Path | Upstream Path |
|--------|----------|---------------|
| GET | `/api/v1/mcp_catalog/mcpservers` | `{basePath}/mcpservers` |
| GET | `/api/v1/mcp_catalog/mcpservers/:name` | `{basePath}/mcpservers/{name}` |

Routes use `AttachNamespace(AttachModelCatalogRESTClient(...))` middleware, matching all other catalog routes.

### Frontend Architecture

```
AppRoutes.tsx
  |-- /mcp-catalog/*       -->  McpCatalogRoutes.tsx
       |                         (wrapped in McpCatalogContextProvider)
       |-- /                -->  McpCatalogPage.tsx      (gallery + filters + search)
       |-- /:serverName     -->  McpServerDetailPage.tsx (overview with badges)
```

**McpCatalogContext** provides:
- Server list fetched from BFF on mount
- Client-side filtering by deploymentMode, category, license, transport
- Text search across name, description, provider

**McpCatalogPage** renders:
- PatternFly `Sidebar` with `McpCatalogFilters` (4 filter groups)
- `SearchInput` for full-text search
- `Gallery` of `McpServerCard` components

**McpServerCard** shows:
- CubesIcon placeholder (logo support ready)
- Verified/Certified badges as PatternFly Labels
- Description (truncated)
- Tool/resource/prompt counts
- LabelGroup with deployment mode (colored), provider, category, license

**McpServerDetailPage** shows:
- Breadcrumb navigation
- Server header with icon, name, provider, badges
- Full description
- Tabs with Overview tab containing DescriptionList of all properties

### Mock Data for Development

The BFF mock client returns all 7 servers with full property coverage, enabling development without a running catalog server. The mock supports both list and get-by-name operations with accurate data matching the YAML provider test data.

## Key Design Decisions

| Decision | Rationale | Alternatives Considered |
|----------|-----------|------------------------|
| AttachNamespace on MCP routes | Consistent with all other catalog routes; required by AttachModelCatalogRESTClient middleware which needs namespace to resolve catalog service | No namespace (caused 400 error from middleware) |
| Client-side filtering | 7 entries is small enough for client-side; avoids BFF filter plumbing | Server-side filterQuery (overkill for <50 items) |
| Separate McpCatalogContext | Isolates MCP state from Model Catalog and Catalog Management contexts | Extending existing contexts |
| Rich mock data in BFF | Enables full gallery experience without catalog server; matches YAML test data | Minimal mock (only showed 1 entry) |
| CubesIcon placeholder | PatternFly icon works for all servers; logo URLs can be data URIs later | No icon (cards look empty) |
| deploymentMode label styling | Blue for "local", orange for "remote" -- matches PatternFly conventions | Same color for both |

## Testing

### Go Tests

All existing and new tests pass:

```bash
# Plugin framework tests (21 tests)
go test ./pkg/catalog/plugin/... -v -count=1

# MCP plugin tests (7 tests including provider tests)
go test ./catalog/plugins/mcp/... -v -count=1
```

### BFF Compilation

```bash
cd clients/ui/bff && go build ./cmd/
```

### Playwright Verification

End-to-end verification confirmed:

1. **MCP Catalog gallery** renders at `/mcp-catalog` with all 7 server cards
2. **Card content** shows names, descriptions, badges (Verified/Certified), tool/resource/prompt counts, deployment mode labels
3. **Sidebar filters** present: Deployment Mode (Local/Remote), Category (Red Hat/DevOps/Database/Communication), License (Apache-2.0/MIT/PostgreSQL), Transport (STDIO/HTTP/SSE)
4. **Filter functionality** -- checking "Local" shows 4 servers, hides 3 remote ones; "Clear all" button appears
5. **Server detail page** renders at `/mcp-catalog/kubernetes-mcp-server` with breadcrumb, header, badges, Overview tab with full DescriptionList
6. **Breadcrumb navigation** works -- clicking "MCP Catalog" returns to gallery
7. **Navigation** shows "MCP Catalog" in sidebar nav between "Model Catalog" and "Settings"
8. **Backward compatibility** -- Model Catalog at `/model-catalog` renders fully; Catalog Management at `/catalog-management` renders with both model and mcp plugin cards

## Verification

```bash
# Build everything
go build ./...
cd clients/ui/bff && go build ./cmd/

# Run tests
go test ./pkg/catalog/plugin/... -v -count=1
go test ./catalog/plugins/mcp/... -v -count=1

# Start dev stack
cd clients/ui/bff && go run ./cmd/ --port=4000 --mock-k8s-client=true \
  --mock-mr-client=true --mock-mr-catalog-client=true --dev-mode=true \
  --deployment-mode=standalone &

cd clients/ui/frontend && DEPLOYMENT_MODE=standalone STYLE_THEME=mui-theme npm run start:dev &

# Verify BFF endpoint
curl -s "http://localhost:4000/api/v1/mcp_catalog/mcpservers?namespace=kubeflow" | python -m json.tool

# Navigate to:
# http://localhost:9000/mcp-catalog                              -- MCP gallery (7 cards)
# http://localhost:9000/mcp-catalog/kubernetes-mcp-server        -- Server detail
# http://localhost:9000/model-catalog                            -- Model Catalog (backward compat)
# http://localhost:9000/catalog-management                       -- Catalog Management (backward compat)
```

## Dependencies & Impact

- **Depends on**: Phase 1 plugin framework, Phase 2 M2.1-M2.4 (management plane, CLI, BFF, tests)
- **Backward compatible**: Existing Model Catalog, Model Registry, Catalog Management, and Settings pages are unaffected
- **New nav entry**: "MCP Catalog" added to sidebar navigation (between Model Catalog and Settings)
- **Mock data**: BFF mock client updated to return realistic 7-server dataset for development

## Open Items

- Logo support: cards use CubesIcon placeholder; real logos need data URIs or hosted image URLs
- Tools/Resources/Prompts tabs on detail page: currently only Overview tab is implemented
- Server-side filtering: when MCP server counts grow beyond ~50, migrate to filterQuery
- Pagination: not needed until server counts exceed ~50
- Search debouncing: currently instant; may need debounce for large datasets
- Integration with real catalog server: mock data used in dev; need Docker Compose for full end-to-end
