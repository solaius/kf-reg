# M5.7: Knowledge Sources Plugin (Exit Criteria)

**Date**: 2026-02-16
**Status**: Complete
**Phase**: Phase 5 - Universal Asset Framework

## Overview

Added a Knowledge Sources plugin to the unified catalog server that serves documents, vector stores, URL sources, and graph stores. The plugin appears in both the generic UI and CLI with zero changes to frontend or CLI code, proving the universal asset framework's capability-driven rendering model. The plugin loads data from YAML files, implements the full V2 capabilities contract, and supports all framework interfaces including source management, actions, asset mapping, and diagnostics.

## Goal

Prove the universal asset framework by adding a Knowledge Sources plugin that appears in UI and CLI with ZERO changes to frontend or CLI code. This is the exit criteria for Phase 5: if a new asset-type plugin can be added and rendered dynamically by generic clients that only read the V2 capabilities document, then the framework is complete.

## Files Created

| File | Size | Purpose |
|------|------|---------|
| `catalog/plugins/knowledge/plugin.go` | 10.5KB | `KnowledgeSourcePlugin` struct implementing the `CatalogPlugin` interface. In-memory YAML-loaded data store with `KnowledgeSourceEntry` type (12 fields including name, sourceType, location, contentType, provider, status, documentCount, vectorDimensions, indexType). Includes `Init`, `Start`, `Stop`, `RegisterRoutes` lifecycle, list/get HTTP handlers with filterQuery support (equality, inequality, LIKE operators, AND combinations), YAML file loading, and thread-safe source map. |
| `catalog/plugins/knowledge/register.go` | 142B | `init()` function calling `plugin.Register(&KnowledgeSourcePlugin{})` for automatic registration via blank import. |
| `catalog/plugins/knowledge/management.go` | 13.4KB | Full V2 capabilities implementation. Declares 8 compile-time interface assertions (`SourceManager`, `RefreshProvider`, `DiagnosticsProvider`, `CapabilitiesProvider`, `CapabilitiesV2Provider`, `UIHintsProvider`, `CLIHintsProvider`, `BasePathProvider`). V2 capabilities document defines 1 entity kind (`KnowledgeSource`) with 6 columns, 4 filter fields (name, sourceType, provider, status), 10 detail fields organized into 3 sections (Overview, Connection, Statistics), UI hints, and 4 action definitions. Source management with `ListSources`, `ValidateSource`, `ApplySource`, `EnableSource`, `DeleteSource`. Refresh with `Refresh` and `RefreshAll`. Diagnostics via `Diagnostics`. V1-compatible `UIHints` and `CLIHints`. |
| `catalog/plugins/knowledge/actions.go` | 2.9KB | `ActionProvider` implementation with `HandleAction` and `ListActions`. Dispatches by scope (source vs. asset). Source-scoped: refresh action. Asset-scoped: delegates to `BuiltinActionHandler` for tag, annotate, and deprecate actions using the shared overlay store. |
| `catalog/plugins/knowledge/asset_mapper.go` | 3.2KB | `AssetMapperProvider` implementation with `knowledgeAssetMapper`. Maps `KnowledgeSourceEntry` (typed struct), `*KnowledgeSourceEntry` (pointer), and `map[string]any` (generic JSON) to `AssetResource` with `apiVersion: catalog/v1alpha1`, `kind: KnowledgeSource`. Populates spec from 8 domain fields and sets `sourceRef` when sourceId is present. |
| `catalog/plugins/knowledge/catalog.yaml` | 1.2KB | Plugin definition declaring entity name, 8 properties with types and descriptions, supported providers (`yaml`), and API base path (`/api/knowledge_catalog/v1alpha1`). |
| `catalog/plugins/knowledge/data/sample-knowledge-sources.yaml` | ~1.5KB | 7 sample knowledge source entries across 4 source types: `document` (company-docs, legacy-wiki), `vector_store` (product-faq-vectordb, support-tickets-embeddings), `url` (research-papers, api-documentation), `graph_store` (customer-knowledge-graph). Entries include realistic providers (Qdrant, Neo4j, PGVector, arXiv, MediaWiki), statuses (active, archived), and domain-specific fields (vectorDimensions, indexType). |

## Files Modified

| File | Change |
|------|--------|
| `catalog/config/sources.yaml` | Added `knowledge` section with `knowledge-default` source configured as `type: yaml`, enabled, with `yamlCatalogPath` pointing to `sample-knowledge-sources.yaml`. |
| `cmd/catalog-server/main.go` | Added blank import `_ "github.com/kubeflow/model-registry/catalog/plugins/knowledge"` to trigger `init()` registration. |
| `Dockerfile.catalog-server` | Added `COPY catalog/plugins/knowledge/data/ /plugins/knowledge/data/` to include sample data in the container image. |
| `docker-compose.catalog.yaml` | Added read-only volume mount `./catalog/plugins/knowledge/data:/plugins/knowledge/data:ro` for local development. |

## Key Design Decisions

| Decision | Rationale |
|----------|-----------|
| In-memory YAML store, no database persistence | The knowledge plugin serves as a proof-of-concept for the framework. YAML loading demonstrates the same ingest pattern used by the MCP plugin. Adding DB persistence is straightforward via `Migrations()` but unnecessary for the exit criteria demonstration. |
| 4 source types (document, vector_store, url, graph_store) | Covers the breadth of real-world knowledge source use cases in RAG/AI pipelines. Each type has different characteristic fields (vectorDimensions for vector_store, indexType for vector_store/graph_store), proving that the generic detail view can handle heterogeneous schemas. |
| Reuse of `BuiltinActionHandler` for tag/annotate/deprecate | Validates that the shared overlay store and builtin action handlers work across plugins without plugin-specific action code. The knowledge plugin gets tag, annotate, and deprecate for free by calling `plugin.NewBuiltinActionHandler()`. |
| 3 detail sections (Overview, Connection, Statistics) | Demonstrates that the generic UI correctly renders multi-section detail views from capabilities alone. Different from the MCP plugin's section names, proving the UI is not hardcoded. |
| Thread-safe source map with `sync.RWMutex` | The plugin supports runtime source addition/removal via `ApplySource` and `DeleteSource`, requiring concurrent-safe access to the in-memory entries map. Read-heavy workload favors `RWMutex` over `Mutex`. |
| Filter support with AND, equality, inequality, LIKE | Matches the filter operators declared in the V2 capabilities `filterFields`, ensuring the conformance suite can validate filter acceptance end-to-end. |

## Exit Criteria Verification

| Criterion | Verification |
|-----------|-------------|
| Zero frontend code changes | No files under `clients/ui/frontend/` were modified. The knowledge plugin appears in the generic catalog UI via the `/api/plugins` capabilities discovery endpoint. The generic `CatalogEntityList` and `CatalogEntityDetail` components render knowledge sources using the V2 column, filter, and detail field definitions. |
| Zero CLI code changes | No files in the CLI (`catalogctl`) package were modified. The command `catalogctl knowledge knowledgesources list` works via dynamic command generation from the V2 capabilities document. Column widths, sort fields, and filterable fields are all driven by `CLIHints`. |
| Plugin visible in `/api/plugins` | The knowledge plugin appears in the plugin listing with `healthy: true`, full V2 `capabilitiesV2` inline, and management capabilities (`sourceManager: true`, `refresh: true`, `diagnostics: true`, `actions: true`). |
| All 7 knowledge sources accessible | `GET /api/knowledge_catalog/v1alpha1/knowledgesources` returns all 7 entries with correct sizes. `GET /api/knowledge_catalog/v1alpha1/knowledgesources/{name}` returns individual entries. |
| Actions work on knowledge source entities | `POST /api/knowledge_catalog/v1alpha1/entities/{name}:action` with tag, annotate, and deprecate actions all return `status: completed` (or `status: dry-run` with dryRun flag). |
| Passes all conformance tests | All conformance checks pass for the knowledge plugin (see M5.8 report for details). |

## Acceptance Criteria

| # | Criterion | Status |
|---|-----------|--------|
| AC1 | Knowledge Sources plugin loads and appears in `/api/plugins` with V2 capabilities | Met |
| AC2 | Generic UI renders knowledge sources in list and detail views without any frontend code changes | Met |
| AC3 | Generic CLI renders knowledge sources in table format without any CLI code changes | Met |
| AC4 | All framework interfaces (SourceManager, RefreshProvider, ActionProvider, AssetMapperProvider, DiagnosticsProvider) implemented and functional | Met |

## Dependencies and Impact

- **Proves**: The universal asset framework is complete. Any new asset-type plugin can be added with the same pattern.
- **Depends on**: M5.1 (V2 capabilities schema), M5.3 (generic UI components), M5.4 (generic CLI), M5.5 (action framework)
- **Validated by**: M5.8 (conformance suite runs all checks against the knowledge plugin)
