# M5.5: Generic UI Components + BFF

**Date**: 2026-02-16
**Status**: Complete
**Phase**: Phase 5 - Universal Asset Framework

## Overview

This milestone delivers capabilities-driven React/PatternFly UI components and BFF proxy handlers that render any catalog plugin without hardcoded plugin-specific logic. The UI discovers plugins at startup, fetches their V2 capabilities documents, and uses that metadata to drive list views, detail pages, filter bars, action buttons, and action dialogs -- all generically. A new BFF layer proxies capabilities and entity CRUD/action requests to the catalog server.

## Goal

Build a generic UI layer and corresponding BFF proxy that renders any plugin/entity using:
- Capabilities document (primary driver for columns, filters, detail fields, actions)
- Standard entity endpoints (list/get/action)
- Zero plugin-specific branching in any generic component

## Files Created

### BFF Backend (Go)

| File | Purpose |
|------|---------|
| `clients/ui/bff/internal/api/catalog_capabilities_handler.go` | `GetPluginCapabilitiesHandler` -- proxies V2 capabilities for a specific plugin via the catalog REST client; returns `json.RawMessage` in a standard envelope |
| `clients/ui/bff/internal/api/catalog_entity_handler.go` | 4 handlers: `GetCatalogEntityListHandler`, `GetCatalogEntityHandler`, `PostCatalogEntityActionHandler`, `PostCatalogSourceActionHandler` -- generic entity list/get/action proxying to the catalog server |
| `clients/ui/bff/internal/repositories/catalog_entities.go` | `CatalogEntitiesInterface` with 5 methods: `GetPluginCapabilities`, `GetCatalogEntityList`, `GetCatalogEntity`, `PostCatalogEntityAction`, `PostCatalogSourceAction`; path templates for capabilities, entity list/get, entity action, and source action |

### Frontend Types (TypeScript)

| File | Purpose |
|------|---------|
| `clients/ui/frontend/src/app/types/capabilities.ts` | TypeScript types for V2 capabilities: `PluginCapabilitiesV2`, `PluginInfo`, `EntityCapabilities`, `V2ColumnHint`, `V2FilterField`, `V2FieldHint`, `ActionDefinition`, `ActionParameter`, `PluginsResponse` |
| `clients/ui/frontend/src/app/types/asset.ts` | Generic entity types: `GenericEntity` (a `Record<string, unknown>`), `GenericEntityList` with `items`, `size`, `nextPageToken` |

### Frontend API Services

| File | Purpose |
|------|---------|
| `clients/ui/frontend/src/app/api/catalogCapabilities/service.ts` | `getAllPlugins(hostPath)` and `getPluginCapabilities(hostPath, pluginName)` -- fetch plugin list and V2 capabilities via BFF using `restGET` from `mod-arch-core` |
| `clients/ui/frontend/src/app/api/catalogEntities/service.ts` | `getEntityList`, `getEntity`, `executeEntityAction` -- generic entity CRUD and action execution via BFF; routes through `/catalog/{plugin}/entities/{plural}` paths |

### Frontend Context and Hooks

| File | Purpose |
|------|---------|
| `clients/ui/frontend/src/app/context/catalog/CatalogContext.tsx` | `CatalogContextProvider` -- loads all plugins on mount via `getAllPlugins`, then fetches `getPluginCapabilities` for each plugin; exposes `plugins`, `pluginsLoaded`, `capabilitiesMap`, `getPluginCaps(name)` |
| `clients/ui/frontend/src/app/hooks/useCatalogPlugins.ts` | Re-exports `useCatalogPlugins` hook from `CatalogContext` for convenience |
| `clients/ui/frontend/src/app/hooks/usePluginEntities.ts` | `usePluginEntities(pluginName, entityPlural, queryParams)` -- manages entity list fetch lifecycle; returns `entities`, `loaded`, `error`, `totalSize`, `nextPageToken`, `refresh()` |

### Frontend Generic Components

| File | Purpose |
|------|---------|
| `clients/ui/frontend/src/app/pages/genericCatalog/components/GenericListView.tsx` | PatternFly `Table` rendered from `EntityCapabilities.fields.columns`; first column (or `nameField`) rendered as a clickable link; uses `getFieldValue` and `formatFieldValue` utilities for dot-path data access |
| `clients/ui/frontend/src/app/pages/genericCatalog/components/GenericFilterBar.tsx` | PatternFly `Toolbar` with `SearchInput`, `Select`, and `Checkbox` filter controls driven by `V2FilterField[]`; supports `text`, `select`, and `boolean` filter types; includes "Clear all filters" button |
| `clients/ui/frontend/src/app/pages/genericCatalog/components/GenericDetailView.tsx` | `DescriptionList` grouped by `detailSections` from `uiHints`; renders each `V2FieldHint` with type-specific widgets: `LabelGroup` for tags, `<a>` for urls, `<pre>` for markdown, fallback `formatFieldValue` for other types |
| `clients/ui/frontend/src/app/pages/genericCatalog/components/GenericActionBar.tsx` | `Flex` row of `Button` components from `ActionDefinition[]`; destructive actions render as `variant="danger"`, others as `variant="secondary"` |
| `clients/ui/frontend/src/app/pages/genericCatalog/components/GenericActionDialog.tsx` | PatternFly `Modal` rendered from `ActionDefinition.parameters`; generates `FormGroup` inputs for `string`, `number`, `boolean`, and `tags` parameter types; initializes defaults from `param.defaultValue`; destructive actions show confirmation prompt when no parameters |
| `clients/ui/frontend/src/app/pages/genericCatalog/utils.ts` | `getFieldValue(entity, path)` -- dot-path accessor for `GenericEntity`; `formatFieldValue(value, type)` -- type-aware string formatter for tags, booleans, dates, and objects |

### Frontend Screens

| File | Purpose |
|------|---------|
| `clients/ui/frontend/src/app/pages/genericCatalog/screens/CatalogHomePage.tsx` | Plugin card grid using PatternFly `Gallery` + `Card`; shows each plugin's display name, description, version, entity count; click navigates to first entity type for the plugin |
| `clients/ui/frontend/src/app/pages/genericCatalog/screens/PluginEntityListPage.tsx` | Generic entity list page; renders `GenericFilterBar` + `GenericListView`; performs client-side filtering using `activeFilters` and `searchTerm`; entity click navigates to detail page |
| `clients/ui/frontend/src/app/pages/genericCatalog/screens/PluginEntityDetailPage.tsx` | Generic entity detail page with breadcrumb navigation; renders `GenericActionBar` + `GenericDetailView` + `GenericActionDialog`; resolves available actions by intersecting `entityCaps.actions` with `caps.actions`; action execution calls `executeEntityAction` and updates displayed data with result |
| `clients/ui/frontend/src/app/pages/genericCatalog/GenericCatalogRoutes.tsx` | Route wrapper: wraps nested routes in `CatalogContextProvider`; routes: `/` (CatalogHomePage), `/:pluginName/:entityPlural` (list), `/:pluginName/:entityPlural/:entityName` (detail) |

## Files Modified

| File | Change |
|------|--------|
| `clients/ui/bff/internal/api/app.go` | Added 5 route constants (`CatalogEntityPlural`, `CatalogEntityName`, `CatalogCapabilitiesPath`, `CatalogEntityListPath`, `CatalogEntityGetPath`, `CatalogEntityActionPath`, `CatalogSourceActionPath`); registered 5 routes (1 capabilities GET, 2 entity GET, 1 entity action POST, 1 source action POST) with `AttachNamespace` + `AttachModelCatalogRESTClient` middleware |
| `clients/ui/bff/internal/repositories/model_catalog_client.go` | Embedded `CatalogEntitiesInterface` in `ModelCatalogClientInterface` |
| `clients/ui/frontend/src/app/AppRoutes.tsx` | Added `GenericCatalogRoutes` import; added "Catalog" nav entry with `/catalog` path; added `<Route path="/catalog/*" element={<GenericCatalogRoutes />} />` alongside existing catalog routes |

## Key Design Decisions

| Decision | Rationale | Alternatives Considered |
|----------|-----------|------------------------|
| All data passed as `json.RawMessage` through BFF | BFF does not need to understand entity schemas; passthrough avoids BFF-side type coupling per plugin | Typed BFF models per entity kind (rejected -- requires BFF changes for each new plugin) |
| `CatalogContextProvider` fetches all plugin capabilities eagerly on mount | Capabilities are small (< 5KB per plugin); eager loading avoids waterfall requests when navigating between plugins | Lazy loading per plugin (rejected -- causes spinner flicker on first navigation to each plugin) |
| Client-side filtering in `PluginEntityListPage` | Acceptable for datasets < 1000 items; avoids requiring all plugins to implement `filterQuery` identically | Server-side `filterQuery` pass-through (planned as enhancement; would use `queryParams` already wired in `usePluginEntities`) |
| Dot-path field access via `getFieldValue` utility | Enables capabilities to reference nested fields (e.g., `status.state`, `metadata.labels`) without flattening server responses | JSONPath or JMESPath library (rejected -- overkill for simple path access patterns seen in capabilities) |
| `GenericActionDialog` builds form from `ActionParameter[]` | Allows plugins to define action parameters declaratively; UI renders appropriate input widget per type | Freeform JSON input (rejected -- poor UX; hard to validate) |
| Zero `if-pluginName` branching in generic components | Core design goal: proves that capabilities-driven rendering works; any plugin-specific logic must live in the capabilities document, not in React code | Conditional rendering per plugin (rejected -- violates Phase 5 principle) |

## How It Works

### BFF Route Structure

| Method | BFF Path | Upstream Path |
|--------|----------|---------------|
| GET | `/api/v1/catalog/:plugin_name/capabilities` | `/api/plugins/{name}/capabilities` |
| GET | `/api/v1/catalog/:plugin_name/entities/:entity_plural` | `/api/{plugin}_catalog/v1alpha1/{plural}` |
| GET | `/api/v1/catalog/:plugin_name/entities/:entity_plural/:entity_name` | `/api/{plugin}_catalog/v1alpha1/{plural}/{name}` |
| POST | `/api/v1/catalog/:plugin_name/entities/:entity_plural/:entity_name/action` | `/api/{plugin}_catalog/v1alpha1/{plural}/{name}:action` |
| POST | `/api/v1/catalog/:plugin_name/sources/:source_id/action` | `/api/{plugin}_catalog/v1alpha1/sources/{id}:action` |

### Frontend Architecture

```
AppRoutes.tsx
  |-- /catalog/*  -->  GenericCatalogRoutes.tsx
       |                 (wrapped in CatalogContextProvider)
       |-- /                               -->  CatalogHomePage.tsx      (plugin card grid)
       |-- /:pluginName/:entityPlural      -->  PluginEntityListPage.tsx (generic list + filters)
       |-- /:pluginName/:entityPlural/:entityName  -->  PluginEntityDetailPage.tsx (detail + actions)
```

### Data Flow

```
1. CatalogContext mounts
2.   -> GET /api/v1/model_catalog/plugins          -> catalog-server GET /api/plugins
3.   -> For each plugin:
4.      GET /api/v1/catalog/{plugin}/capabilities   -> catalog-server GET /api/plugins/{name}/capabilities
5. User navigates to /catalog/mcp/mcpservers
6.   -> usePluginEntities("mcp", "mcpservers")
7.      -> GET /api/v1/catalog/mcp/entities/mcpservers  -> catalog-server GET /api/mcp_catalog/v1alpha1/mcpservers
8. GenericListView renders columns from capabilitiesMap["mcp"].entities[0].fields.columns
9. User clicks entity row -> navigates to /catalog/mcp/mcpservers/{name}
10.  -> getEntity("mcp", "mcpservers", "{name}")
11.     -> GET /api/v1/catalog/mcp/entities/mcpservers/{name}
12. GenericDetailView renders fields from detailFields grouped by detailSections
13. GenericActionBar renders actions from capabilities; click opens GenericActionDialog
14.  -> executeEntityAction("mcp", "mcpservers", "{name}", actionId, params)
15.     -> POST /api/v1/catalog/mcp/entities/mcpservers/{name}/action
```

## Verification Results

```bash
# BFF compilation
cd clients/ui/bff && go build ./cmd/
# Result: builds successfully with all new handlers and repositories

# Frontend TypeScript compilation
cd clients/ui/frontend && npx tsc --noEmit
# Result: No TypeScript errors found

# BFF dev server
cd clients/ui/bff && go run ./cmd/ --port=4000 --mock-k8s-client=true \
  --mock-mr-client=true --mock-mr-catalog-client=true --dev-mode=true \
  --deployment-mode=standalone

# Frontend dev server
cd clients/ui/frontend
DEPLOYMENT_MODE=standalone STYLE_THEME=mui-theme npm run start:dev

# Navigate to:
# http://localhost:9000/catalog                     -- CatalogHomePage: card grid shows all plugins
# http://localhost:9000/catalog/model/catalogmodels  -- PluginEntityListPage: model list with filters
# http://localhost:9000/catalog/mcp/mcpservers       -- PluginEntityListPage: MCP server list
# http://localhost:9000/catalog/mcp/mcpservers/github  -- PluginEntityDetailPage: detail + actions

# Backward compatibility:
# http://localhost:9000/model-catalog               -- Existing model catalog page unchanged
# http://localhost:9000/mcp-catalog                  -- Existing MCP catalog page unchanged
# http://localhost:9000/catalog-management           -- Existing management page unchanged
```

### Plugin-Specific Branching Audit

A search for plugin-name conditionals (`if.*pluginName.*===`, `switch.*pluginName`) across all files in `pages/genericCatalog/` returns zero matches. All rendering decisions are driven by the capabilities JSON.

## Acceptance Criteria

| AC | Description | Status |
|----|-------------|--------|
| AC1 | Plugin appears in nav and CatalogHomePage based solely on capabilities -- no hardcoded plugin list | Met -- "Catalog" nav entry links to CatalogHomePage which renders from `plugins` array fetched via discovery; any plugin with capabilities appears automatically |
| AC2 | List view works for model and MCP (and any future plugin) with no plugin-specific code | Met -- `GenericListView` renders columns from `EntityCapabilities.fields.columns`; same component used for all plugins |
| AC3 | Filters render from `filterFields` and produce correct client-side filtering | Met -- `GenericFilterBar` supports text, select, boolean filter types from capabilities; `PluginEntityListPage` applies filters via `activeFilters` state |
| AC4 | Actions render from action definitions, display parameter dialog, and execute via BFF | Met -- `GenericActionBar` renders buttons from `ActionDefinition[]`; `GenericActionDialog` generates parameter forms; execution calls `executeEntityAction` via BFF proxy |
| AC5 | Detail view renders sections from `detailFields` grouped by `detailSections` | Met -- `GenericDetailView` groups fields by `section` attribute; renders type-specific widgets for tags, urls, markdown |
| AC6 | No `if-pluginName` branching in any generic component | Met -- zero plugin-specific conditionals in `pages/genericCatalog/` or `context/catalog/` |

## Status

**Complete.** All 6 acceptance criteria met. BFF compiles and serves. Frontend TypeScript compiles cleanly. Existing model catalog, MCP catalog, and catalog management pages remain unaffected.

## Dependencies & Impact

- **Depends on**: Phase 1 M4 (BFF plugin discovery), Phase 5 M5.3 (capabilities V2 schema on catalog-server)
- **Enables**: M5.6 (CLI v2 can share the same capabilities model), M5.8 (Knowledge Sources plugin proves zero-code-change extensibility in UI)
- **Backward compatible**: Additive routes and components only; no existing routes, handlers, or pages modified in a breaking way

## Open Items

- Client-side filtering works but does not pass `filterQuery` to the server; for datasets > 1000 items, server-side filtering should be enabled via the `queryParams` parameter already wired in `usePluginEntities`
- Pagination (`nextPageToken`) is tracked in state but the UI does not yet render a "Load more" button
- Action execution error feedback is logged but not surfaced as a PatternFly `Alert` or toast notification
- The `GenericActionDialog` tags input is a simple comma-separated `TextInput`; a proper `LabelGroup` chip input would improve UX
- No component-level unit tests yet for the generic components (planned as part of M5.9 conformance testing)
