# M6.2: Prompt Templates Plugin

**Date**: 2026-02-17
**Status**: Complete
**Phase**: Phase 6 - Core Asset Coverage

## Summary

Added a Prompt Templates plugin to the unified catalog server for managing reusable AI prompt definitions. The plugin loads 12 sample prompt templates from YAML, implements the full V2 capabilities contract, and appears in the generic UI and CLI with zero frontend or CLI code changes. Supports 5 template formats (chat_messages, completion, jinja2, handlebars, raw) with parameters schema, output schema, and model constraints.

## Motivation

- Prompt templates are a core AI asset type that should be cataloged alongside models, agents, and MCP servers.
- Standards like LangChain PromptTemplate, HuggingFace chat_template, and MCP prompt definitions show industry demand for structured prompt management.
- Validates the Phase 5 framework scales to new asset types with the same in-memory plugin pattern.

## What Changed

### Files Created

| File | Purpose |
|------|---------|
| `catalog/plugins/prompts/plugin.go` | `PromptTemplatePlugin` struct implementing `CatalogPlugin`. Entity struct `PromptTemplateEntry` with 13 fields (name, format, template, parametersSchema, outputSchema, modelConstraints, examples, taskTags, version, author, license). Init/Start/Stop lifecycle, list/get HTTP handlers with filterQuery support, YAML loading. |
| `catalog/plugins/prompts/register.go` | `init()` calling `plugin.Register(&PromptTemplatePlugin{})` for auto-registration via blank import. |
| `catalog/plugins/prompts/management.go` | V2 capabilities with 5 columns, 4 filter fields (name/text, format/select, taskTags/text, author/text), 10 detail fields in 4 sections (Overview, Template, Parameters, Model Constraints). Source management (ListSources, ValidateSource, ApplySource, EnableSource, DeleteSource), Refresh, Diagnostics, UIHints, CLIHints. 8 compile-time interface assertions. |
| `catalog/plugins/prompts/actions.go` | `ActionProvider` with source-scoped refresh and asset-scoped tag/annotate/deprecate via `BuiltinActionHandler`. |
| `catalog/plugins/prompts/asset_mapper.go` | `AssetMapperProvider` mapping `PromptTemplateEntry` to `AssetResource` with kind `PromptTemplate`. |
| `catalog/plugins/prompts/data/sample-prompts.yaml` | 12 sample prompt templates: code-review-assistant, text-summarizer, language-translator, data-extraction, sentiment-analysis, sql-generation, email-drafting, bug-report-triage, api-doc-generator, test-case-generator, meeting-notes-summarizer, persona-chatbot. |

### Files Modified

| File | Change |
|------|--------|
| `cmd/catalog-server/main.go` | Added blank import `_ "github.com/kubeflow/model-registry/catalog/plugins/prompts"` |
| `catalog/config/sources.yaml` | Added `prompts` section with `prompts-default` YAML source |
| `docker-compose.catalog.yaml` | Added volume mount `./catalog/plugins/prompts/data:/plugins/prompts/data:ro` |

## How It Works

### Entity Schema

```go
type PromptTemplateEntry struct {
    Name             string           `yaml:"name" json:"name"`
    Format           *string          `yaml:"format" json:"format,omitempty"`
    Template         *string          `yaml:"template" json:"template,omitempty"`
    ParametersSchema map[string]any   `yaml:"parametersSchema" json:"parametersSchema,omitempty"`
    OutputSchema     map[string]any   `yaml:"outputSchema" json:"outputSchema,omitempty"`
    ModelConstraints map[string]any   `yaml:"modelConstraints" json:"modelConstraints,omitempty"`
    Examples         []map[string]any `yaml:"examples" json:"examples,omitempty"`
    TaskTags         []string         `yaml:"taskTags" json:"taskTags,omitempty"`
    Version          *string          `yaml:"version" json:"version,omitempty"`
    Author           *string          `yaml:"author" json:"author,omitempty"`
    License          *string          `yaml:"license" json:"license,omitempty"`
}
```

### V2 Capabilities Summary

- **Entity kind**: `PromptTemplate` (plural: `prompttemplates`)
- **Columns**: Name, Format, Task Tags, Version, Author
- **Filters**: Name (text), Format (select: chat_messages/completion/jinja2/handlebars/raw), Task Tags (text), Author (text)
- **Detail sections**: Overview, Template, Parameters, Model Constraints
- **Actions**: tag, annotate, deprecate, refresh
- **Source types**: `["yaml"]`

### API Endpoints

- `GET /api/prompts_catalog/v1alpha1/prompttemplates` - List all templates
- `GET /api/prompts_catalog/v1alpha1/prompttemplates/{name}` - Get by name

## Key Design Decisions

| Decision | Rationale | Alternatives Considered |
|----------|-----------|------------------------|
| 5 format types covering major patterns | `chat_messages` (OpenAI/Anthropic), `completion` (single-turn), `jinja2`/`handlebars` (templating engines), `raw` (freeform) covers the industry landscape | Fewer types (insufficient coverage), more types (premature) |
| `parametersSchema` as JSON Schema | Industry standard for defining template variables; enables validation and UI form generation | Custom schema format (non-standard) |
| `modelConstraints` as optional map | Not all prompts are model-specific; when present, hints at compatible model families and token limits | Required field (too restrictive for generic prompts) |
| In-memory store, no DB persistence | Consistent with Knowledge plugin pattern; DB upgrade path exists via `Migrations()` | DB-backed from start (unnecessary complexity for catalog metadata) |

## Testing

- Plugin follows the same pattern as the Knowledge plugin, validated through the conformance suite
- Manual verification: plugin appears in UI list/detail views, filters work, actions respond
- Run: `go vet ./catalog/plugins/prompts/...`

## Verification

```bash
# Verify plugin compiles
go vet ./catalog/plugins/prompts/...

# With catalog server running:
curl -s http://localhost:8080/api/plugins/prompts/capabilities | python3 -m json.tool
curl -s http://localhost:8080/api/prompts_catalog/v1alpha1/prompttemplates | python3 -m json.tool
curl -s http://localhost:8080/api/prompts_catalog/v1alpha1/prompttemplates/text-summarizer | python3 -m json.tool
```

## Dependencies & Impact

- **Enables**: M6.3 (Agents can reference prompts via `promptRefs`), M6.6 (stack assembly)
- **Depends on**: M6.1 (stack preparation), Phase 5 framework
- **Backward compatibility**: No changes to existing plugins or UI/CLI code

## Open Items

- Git provider wiring (deferred; Agents plugin prioritized for Git integration)
- Prompt rendering/execution endpoint (out of scope; catalog is discovery-only)
