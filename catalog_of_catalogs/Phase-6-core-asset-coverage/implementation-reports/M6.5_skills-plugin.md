# M6.5: Skills Plugin

**Date**: 2026-02-17
**Status**: Complete
**Phase**: Phase 6 - Core Asset Coverage

## Summary

Added a Skills plugin cataloging tools, operations, and executable actions that agents can invoke. The plugin models 4 skill types (MCP tools, OpenAPI operations, Kubernetes actions, shell commands) with safety constraints, rate limits, timeouts, retry policies, and compatibility metadata. Includes 12 sample skills with realistic fields and safety indicators. Skills are directly linkable from Agent entries via `skillRef` cross-asset references.

## Motivation

- Skills (tools/commands) are the primary mechanism by which agents interact with the outside world. Cataloging them enables discovery, safety assessment, and governance.
- The MCP tool pattern (name, description, inputSchema) is the de facto standard for LLM tool calling; this plugin extends it with execution, safety, and operational metadata.
- Risk level classification (`low`, `medium`, `high`) is essential for agent safety â€” `shell_command` skills default to `requiresApproval: true`.
- Skills complement the Agents plugin directly as the primary cross-reference target.

## What Changed

### Files Created

| File | Purpose |
|------|---------|
| `catalog/plugins/skills/plugin.go` | `SkillPlugin` struct. Entity `SkillEntry` with 14 fields (name, skillType, inputSchema, outputSchema, execution, safety, rateLimit, timeoutSeconds, retryPolicy, compatibility, version, author, license). List/get handlers with filterQuery including `riskLevel` filter via nested `safety.riskLevel` path. |
| `catalog/plugins/skills/register.go` | `init()` calling `plugin.Register(&SkillPlugin{})`. |
| `catalog/plugins/skills/management.go` | V2 capabilities: 5 columns (name, skillType, riskLevel, version, author), 3 filter fields (name/text, skillType/select, riskLevel/select), 13 detail fields in 4 sections (Overview, Input/Output Schema, Execution, Safety & Constraints). 8 compile-time interface assertions. |
| `catalog/plugins/skills/actions.go` | `ActionProvider` with source refresh and asset tag/annotate/deprecate. |
| `catalog/plugins/skills/asset_mapper.go` | `AssetMapperProvider` mapping `SkillEntry` to `AssetResource` with kind `Skill`. |
| `catalog/plugins/skills/data/sample-skills.yaml` | 12 sample skills: web-search, file-read, database-query, k8s-pod-logs, run-pytest, code-formatter, api-health-check, send-notification, image-resize, git-commit-info, vector-store-query, deploy-model. |

### Files Modified

| File | Change |
|------|--------|
| `cmd/catalog-server/main.go` | Added blank import `_ "github.com/kubeflow/model-registry/catalog/plugins/skills"` |
| `catalog/config/sources.yaml` | Added `skills` section with `skills-default` YAML source |
| `docker-compose.catalog.yaml` | Added volume mount `./catalog/plugins/skills/data:/plugins/skills/data:ro` |

## How It Works

### Entity Schema

```go
type SkillEntry struct {
    Name           string         `yaml:"name" json:"name"`
    SkillType      *string        `yaml:"skillType" json:"skillType,omitempty"`
    InputSchema    map[string]any `yaml:"inputSchema" json:"inputSchema,omitempty"`
    OutputSchema   map[string]any `yaml:"outputSchema" json:"outputSchema,omitempty"`
    Execution      map[string]any `yaml:"execution" json:"execution,omitempty"`
    Safety         map[string]any `yaml:"safety" json:"safety,omitempty"`
    RateLimit      map[string]any `yaml:"rateLimit" json:"rateLimit,omitempty"`
    TimeoutSeconds *int32         `yaml:"timeoutSeconds" json:"timeoutSeconds,omitempty"`
    RetryPolicy    map[string]any `yaml:"retryPolicy" json:"retryPolicy,omitempty"`
    Compatibility  map[string]any `yaml:"compatibility" json:"compatibility,omitempty"`
}
```

### Skill Types

| Type | Description | Example |
|------|-------------|---------|
| `mcp_tool` | MCP server tool invocation | web-search, file-read, send-notification |
| `openapi_operation` | REST API operation via OpenAPI | database-query, api-health-check |
| `k8s_action` | Kubernetes resource operation | k8s-pod-logs, deploy-model |
| `shell_command` | Local command execution | run-pytest, code-formatter, git-commit-info |

### Safety Model

The `safety` field is a structured map with:

```yaml
safety:
  riskLevel: "high"              # low, medium, high
  requiresApproval: true         # shell_command defaults to true
  networkAccessRequired: true
  secretRefs:
    - name: "db-credentials"
  allowedNamespaces:
    - "production"
```

The `riskLevel` column in the V2 capabilities uses a nested path (`safety.riskLevel`), and the `getFieldValue` function handles this by extracting from the safety map:

```go
case "riskLevel":
    if s, ok := entry.Safety["riskLevel"].(string); ok {
        return s
    }
    return ""
```

### V2 Capabilities Summary

- **Entity kind**: `Skill` (plural: `skills`)
- **Columns**: Name, Type (skillType), Risk Level (safety.riskLevel), Version, Author
- **Filters**: Name (text), Skill Type (select: mcp_tool/openapi_operation/k8s_action/shell_command), Risk Level (select: low/medium/high)
- **Detail sections**: Overview, Input/Output Schema, Execution, Safety & Constraints
- **Actions**: tag, annotate, deprecate, refresh
- **Source types**: `["yaml"]`

### Sample Skills Coverage

| Risk Level | Count | Examples |
|------------|-------|---------|
| Low | 7 | web-search, file-read, k8s-pod-logs, api-health-check, send-notification, image-resize, vector-store-query |
| Medium | 3 | database-query, code-formatter, git-commit-info |
| High | 2 | run-pytest (shell_command, requiresApproval: true), deploy-model (k8s_action, requiresApproval: true) |

## Key Design Decisions

| Decision | Rationale | Alternatives Considered |
|----------|-----------|------------------------|
| 4 skill types covering tool-calling landscape | MCP tools, OpenAPI operations, K8s actions, and shell commands cover the major tool-calling patterns in AI systems | Fewer types (insufficient), more granular (premature) |
| Safety as a structured map, not flat fields | Safety constraints are multi-dimensional (risk level, approval, network access, secrets, namespaces); a map groups them logically | Flat fields (clutters the top-level entity, poor grouping) |
| `riskLevel` as a V2 column via nested path | Risk level is the most actionable safety indicator for list-view triage | Not showing safety in list view (hides critical info) |
| `shell_command` defaults to `requiresApproval: true` | Shell commands have the highest blast radius and must require explicit approval by default | Advisory default (too dangerous for unreviewed commands) |
| Rate limit and retry as separate maps | Different concerns: rate limiting protects the target system, retry policies handle transient failures | Combined operational config (conflates different concerns) |

## Testing

- Plugin follows the Knowledge plugin pattern, validated through the conformance suite
- Manual verification: all 12 skills visible in UI with risk level column, filter dropdowns for skill type and risk level work
- Run: `go vet ./catalog/plugins/skills/...`

## Verification

```bash
# Verify plugin compiles
go vet ./catalog/plugins/skills/...

# With catalog server running:
curl -s http://localhost:8080/api/skills_catalog/v1alpha1/skills | python3 -m json.tool
curl -s http://localhost:8080/api/skills_catalog/v1alpha1/skills/run-pytest | python3 -m json.tool

# Filter by risk level
curl -s "http://localhost:8080/api/skills_catalog/v1alpha1/skills?filterQuery=riskLevel%3D'high'" | python3 -m json.tool

# Filter by skill type
curl -s "http://localhost:8080/api/skills_catalog/v1alpha1/skills?filterQuery=skillType%3D'shell_command'" | python3 -m json.tool
```

## Dependencies & Impact

- **Enables**: M6.6 (stack assembly), cross-asset linking from Agents plugin
- **Depends on**: M6.1 (stack preparation), Phase 5 framework
- **Referenced by**: Agents plugin via `skillRef` cross-asset links
- **Backward compatibility**: No changes to existing plugins or UI/CLI code

## Open Items

- Skill execution/invocation endpoint (out of scope; catalog is discovery-only)
- MCP server reference resolution (linking `execution.mcpServerRef` to MCP plugin entities)
- OpenAPI spec fetching for `openapi_operation` skills (deferred to runtime integration)
