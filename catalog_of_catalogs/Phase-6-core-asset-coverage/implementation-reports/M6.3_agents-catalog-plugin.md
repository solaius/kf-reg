# M6.3: Agents Catalog Plugin

**Date**: 2026-02-17
**Status**: Complete
**Phase**: Phase 6 - Core Asset Coverage

## Summary

Added an Agents catalog plugin that serves as the centerpiece of Phase 6, demonstrating cross-asset linking across all other plugin types. The plugin catalogs AI agents with references to skills, knowledge sources, guardrails, policies, and prompt templates. It includes 10 sample agents with realistic cross-asset references, implements the full V2 capabilities contract with 7 detail sections, and declares support for both YAML and Git source types. The `extractCrossLinks()` function populates `AssetLinks.Related` for cross-asset discovery.

## Motivation

- Agents are the primary consumer of all other AI assets (they use skills/tools, reference knowledge, apply guardrails, follow policies, and use prompt templates).
- Cross-asset linking validates that the universal asset contract's `AssetLinks.Related` field works in practice.
- Git provider support (declared in capabilities) enables teams to manage agent definitions in version-controlled repositories.
- Highest priority plugin per the Phase 6 plan due to its role as the integration hub.

## What Changed

### Files Created

| File | Purpose |
|------|---------|
| `catalog/plugins/agents/plugin.go` | `AgentPlugin` struct implementing `CatalogPlugin`. Entity struct `AgentEntry` with 17 fields (name, agentType, instructions, modelConfig, tools, knowledge, guardrails, policies, promptRefs, dependencies, inputSchema, outputSchema, examples, category, version, author, license). Full lifecycle, list/get handlers with filterQuery. |
| `catalog/plugins/agents/register.go` | `init()` calling `plugin.Register(&AgentPlugin{})`. |
| `catalog/plugins/agents/management.go` | V2 capabilities with 5 columns, 3 filter fields, 18 detail fields in 7 sections. Source management with `yaml` and `git` type validation. 8 compile-time interface assertions. |
| `catalog/plugins/agents/actions.go` | `ActionProvider` with source-scoped refresh and asset-scoped tag/annotate/deprecate. |
| `catalog/plugins/agents/asset_mapper.go` | `AssetMapperProvider` with `extractCrossLinks()` that populates `AssetLinks.Related` from tools (skillRef, mcpToolRef), knowledge (knowledgeSourceRef), guardrails (guardrailRef), policies (policyRef), promptRefs (promptTemplateRef), and dependencies (agentRef). |
| `catalog/plugins/agents/data/sample-agents.yaml` | 10 sample agents: customer-support-agent, code-review-agent, research-orchestrator, query-router, code-executor, output-evaluator, data-analyst, meeting-assistant, security-scanner, onboarding-guide. |

### Files Modified

| File | Change |
|------|--------|
| `cmd/catalog-server/main.go` | Added blank import `_ "github.com/kubeflow/model-registry/catalog/plugins/agents"` |
| `catalog/config/sources.yaml` | Added `agents` section with `agents-default` YAML source |
| `docker-compose.catalog.yaml` | Added volume mount `./catalog/plugins/agents/data:/plugins/agents/data:ro` |

## How It Works

### Entity Schema

```go
type AgentEntry struct {
    Name         string           `yaml:"name" json:"name"`
    AgentType    *string          `yaml:"agentType" json:"agentType,omitempty"`
    Instructions *string          `yaml:"instructions" json:"instructions,omitempty"`
    ModelConfig  map[string]any   `yaml:"modelConfig" json:"modelConfig,omitempty"`
    Tools        []map[string]any `yaml:"tools" json:"tools,omitempty"`
    Knowledge    []map[string]any `yaml:"knowledge" json:"knowledge,omitempty"`
    Guardrails   []map[string]any `yaml:"guardrails" json:"guardrails,omitempty"`
    Policies     []map[string]any `yaml:"policies" json:"policies,omitempty"`
    PromptRefs   []map[string]any `yaml:"promptRefs" json:"promptRefs,omitempty"`
    Dependencies []map[string]any `yaml:"dependencies" json:"dependencies,omitempty"`
    Category     *string          `yaml:"category" json:"category,omitempty"`
}
```

### Cross-Asset Linking

The `extractCrossLinks()` function in `asset_mapper.go` extracts references from the agent's structured fields:

```go
func extractCrossLinks(e AgentEntry) *plugin.AssetLinks {
    var links []plugin.LinkRef
    for _, t := range e.Tools {
        if ref, ok := t["skillRef"].(string); ok && ref != "" {
            links = append(links, plugin.LinkRef{Kind: "Skill", Name: ref})
        }
        if ref, ok := t["mcpToolRef"].(string); ok && ref != "" {
            links = append(links, plugin.LinkRef{Kind: "McpServer", Name: ref})
        }
    }
    for _, k := range e.Knowledge {
        if ref, ok := k["knowledgeSourceRef"].(string); ok {
            links = append(links, plugin.LinkRef{Kind: "KnowledgeSource", Name: ref})
        }
    }
    // ... guardrails, policies, promptRefs, dependencies
    return &plugin.AssetLinks{Related: links}
}
```

### V2 Capabilities Summary

- **Entity kind**: `Agent` (plural: `agents`)
- **Columns**: Name, Type, Category, Version, Author
- **Filters**: Name (text), Agent Type (select: conversational/task_oriented/router/planner/executor/evaluator), Category (text)
- **Detail sections**: Overview, Instructions, Model Configuration, Tools & Knowledge, Guardrails & Policies, Dependencies, Input/Output
- **Actions**: tag, annotate, deprecate, refresh
- **Source types**: `["yaml", "git"]`

### Sample Agent Cross-References (customer-support-agent)

```yaml
tools:
  - skillRef: web-search          # -> Skill plugin
  - skillRef: send-notification   # -> Skill plugin
knowledge:
  - knowledgeSourceRef: product-faq-vectordb   # -> Knowledge plugin
  - knowledgeSourceRef: company-docs           # -> Knowledge plugin
guardrails:
  - guardrailRef: pii-detector              # -> Guardrails plugin
  - guardrailRef: content-safety-filter     # -> Guardrails plugin
policies:
  - policyRef: model-access-control         # -> Policies plugin
promptRefs:
  - promptTemplateRef: persona-chatbot      # -> Prompts plugin
```

## Key Design Decisions

| Decision | Rationale | Alternatives Considered |
|----------|-----------|------------------------|
| 6 agent types matching industry patterns | `conversational`, `task_oriented`, `router`, `planner`, `executor`, `evaluator` cover LangChain, CrewAI, AutoGen, and A2A patterns | Fewer types (insufficient), custom taxonomy (non-standard) |
| Cross-asset refs as `[]map[string]any` | Flexible for different reference patterns (skillRef, mcpToolRef, openapiToolRef); avoids tight coupling to other plugin schemas | Typed structs (would require circular imports or shared types) |
| `extractCrossLinks` populates `AssetLinks.Related` | Enables generic UI to display cross-asset navigation without plugin-specific rendering code | Manual links (requires UI code per plugin) |
| Both `yaml` and `git` in source types | Agents are the most likely to be managed in Git repos by teams; validates Git provider wiring | YAML-only (misses exit criteria for 2+ provider types) |
| 7 detail sections | Agents have the richest schema; grouping by concern (model config, tools, guardrails) improves readability in the generic detail view | Fewer sections (overwhelming single-section view) |

## Testing

- Plugin follows the Knowledge plugin pattern, validated through the conformance suite
- Manual verification: all 10 agents visible in UI with proper columns, detail view shows all 7 sections with cross-asset references
- Run: `go vet ./catalog/plugins/agents/...`

## Verification

```bash
# Verify plugin compiles
go vet ./catalog/plugins/agents/...

# With catalog server running:
curl -s http://localhost:8080/api/plugins/agents/capabilities | python3 -m json.tool
curl -s http://localhost:8080/api/agents_catalog/v1alpha1/agents | python3 -m json.tool
curl -s http://localhost:8080/api/agents_catalog/v1alpha1/agents/customer-support-agent | python3 -m json.tool

# Verify cross-asset links in asset mapping
curl -s http://localhost:8080/api/agents_catalog/v1alpha1/agents/customer-support-agent | \
  python3 -c "import sys,json; d=json.load(sys.stdin); print('tools:', d.get('tools',[])); print('guardrails:', d.get('guardrails',[]))"
```

## Dependencies & Impact

- **Enables**: M6.6 (stack assembly, cross-asset link validation)
- **Depends on**: M6.1 (Git provider, stack prep), M6.2 (prompts plugin for prompt references)
- **Cross-links to**: Skills, Knowledge Sources, Guardrails, Policies, Prompt Templates plugins
- **Backward compatibility**: No changes to existing plugins or UI/CLI code

## Git Provider Runtime Wiring (Completed)

The Agents plugin is the first plugin to wire the Git provider at runtime, closing the Phase 6 exit criterion for 2+ provider types exercised:

- `Init()` dispatches on `src.Type` for both `yaml` and `git` sources
- `loadGitSource()` converts `plugin.SourceConfig` to `catalog.Source`, creates a `gitprovider.Provider`, calls `Records()`, and drains the initial batch
- `Stop()` cancels all git provider background sync goroutines
- `Refresh()` and `RefreshAll()` dispatch via `refreshSource()` to handle both yaml and git source types
- `slogGitLogger` adapts `slog.Logger` to the git provider's `Logger` interface
- Docker Compose mounts a bare git repo at `/sample-repos/agents-repo` for local testing
- Verified: 12 agents total (10 YAML + 2 Git) visible in UI with full detail rendering

## Open Items

- Agent execution/invocation endpoints (out of scope; catalog is discovery-only)
- A2A protocol integration for multi-agent handoffs (future work)
